"use strict";var FILING_MINS={vis:1.5,ceiling:500},ALT_REQ={vis:3,ceiling:2000},ALT_MINS={vis:2,ceiling:1000},NO_CEIL_VAL=99900,STOPLIGHT_GREEN_CLASS="greenLight",STOPLIGHT_YELLOW_CLASS="yellowLight",STOPLIGHT_RED_CLASS="redLight",HOME_STATION_CLASS="homeStation",ALT_CLASS="alternate",METAR_STALE_TIME=5400000;function makeUrl(a,b){var c;switch(a.toUpperCase()){case"TAFS":c="tafs&hoursBeforeNow=24&mostRecentForEachStation=true&stationString=";break;case"METARS":c="metars&hoursBeforeNow=3&mostRecentForEachStation=true&stationString=";break;case"FIELDS":c="stations&stationString=";break;default:return"https://www.aviationweather.gov/adds/dataserver_current/current/";}return["https://www.aviationweather.gov","/adds","/dataserver_current","/httpparam?","requestType=retrieve","&format=xml","&dataSource=",c,b.replace(/\s/g,"%20")].join("")}function hasCeil(a){if(a===void 0)return!1;if(Array.isArray(a))return 0<a.filter(function(c){var d=c["@attributes"].sky_cover;return"BKN"===d||"OVC"===d||"OVX"===d}).length;var b=a["@attributes"].sky_cover;return"BKN"===b||"OVC"===b||"OVX"===b}function getCeilFromSkyCond(a){return hasCeil(a)?Array.isArray(a)?a.filter(function(b){return"BKN"===b["@attributes"].sky_cover||"OVC"===b["@attributes"].sky_cover||"OVX"===b["@attributes"].sky_cover}).reduce(function(b,c){return+(c["@attributes"].cloud_base_ft_agl<b?c["@attributes"].cloud_base_ft_agl:b)},NO_CEIL_VAL):a["@attributes"].cloud_base_ft_agl:NO_CEIL_VAL}function canFile(a){var b=1<arguments.length&&arguments[1]!==void 0&&arguments[1];if(!b&&a.visibility_statute_mi!==void 0)return a.visibility_statute_mi>=FILING_MINS.vis;return b&&void 0!==a.visibility_statute_mi?a.visibility_statute_mi>=FILING_MINS.vis&&getCeilFromSkyCond(a.sky_condition)>=FILING_MINS.ceiling:b||void 0!==a.visibility_statute_mi?b&&void 0===a.visibility_statute_mi?getCeilFromSkyCond(a.sky_condition)>=FILING_MINS.ceiling:void 0:!0}function altReqd(a){return a.visibility_statute_mi!==void 0&&a.visibility_statute_mi<ALT_REQ.vis||getCeilFromSkyCond(a.sky_condition)<ALT_REQ.ceiling}function isValidAlt(a){return(!(a.visibility_statute_mi!==void 0)||a.visibility_statute_mi>=ALT_MINS.vis)&&getCeilFromSkyCond(a.sky_condition)>=ALT_MINS.ceiling}function belowMinsForTempShwrs(a){return(a.visibility_statute_mi!==void 0&&a.visibility_statute_mi<ALT_MINS.vis||getCeilFromSkyCond(a.sky_condition)<ALT_REQ.ceiling)&&/(TS|SHRA|SHSN)/i.test(a.wx_string)&&/TEMPO/i.test(a.change_indicator)}function getStoplightClassFromMetar(a){var b=1<arguments.length&&arguments[1]!==void 0&&arguments[1];return b&&!canFile(a)?STOPLIGHT_RED_CLASS:b&&altReqd(a)?STOPLIGHT_YELLOW_CLASS:b?STOPLIGHT_GREEN_CLASS:isValidAlt(a)?STOPLIGHT_GREEN_CLASS:STOPLIGHT_RED_CLASS}function getStoplightClassFromTaf(a){var b=1<arguments.length&&arguments[1]!==void 0&&arguments[1];return b&&!canFile(a)?STOPLIGHT_RED_CLASS:b&&altReqd(a)?STOPLIGHT_YELLOW_CLASS:b?STOPLIGHT_GREEN_CLASS:isValidAlt(a)?belowMinsForTempShwrs(a)?STOPLIGHT_YELLOW_CLASS:STOPLIGHT_GREEN_CLASS:STOPLIGHT_RED_CLASS}function convertTextTime(a){var b=a.replace(/^"?(\d{4})-(\d\d)-(\d\d)T(\d\d):(\d\d):(\d\d)Z"?$/i,"$1"),c=a.replace(/^"?(\d{4})-(\d\d)-(\d\d)T(\d\d):(\d\d):(\d\d)Z"?$/i,"$2")-1,d=a.replace(/^"?(\d{4})-(\d\d)-(\d\d)T(\d\d):(\d\d):(\d\d)Z"?$/i,"$3"),e=a.replace(/^"?(\d{4})-(\d\d)-(\d\d)T(\d\d):(\d\d):(\d\d)Z"?$/i,"$4"),f=a.replace(/^"?(\d{4})-(\d\d)-(\d\d)T(\d\d):(\d\d):(\d\d)Z"?$/i,"$5");return new Date(Date.UTC(b,c,d,e,f))}function getLocalFromIsoZulu(a){var b=+new Date().toString().match(/([\+-][0-9][0-9])/)[1],c=+a.replace(/^"?(\d{4})-(\d\d)-(\d\d)T(\d\d):(\d\d):(\d\d)Z"?$/i,"$1"),d=+a.replace(/^"?(\d{4})-(\d\d)-(\d\d)T(\d\d):(\d\d):(\d\d)Z"?$/i,"$2")-1,e=+a.replace(/^"?(\d{4})-(\d\d)-(\d\d)T(\d\d):(\d\d):(\d\d)Z"?$/i,"$3"),f=+a.replace(/^"?(\d{4})-(\d\d)-(\d\d)T(\d\d):(\d\d):(\d\d)Z"?$/i,"$4");return new Date(c,d,e,f+b)}function qcStoplight(a,b){return null===b?a:b===STOPLIGHT_RED_CLASS||a===STOPLIGHT_RED_CLASS?STOPLIGHT_RED_CLASS:b===STOPLIGHT_YELLOW_CLASS||a===STOPLIGHT_YELLOW_CLASS?STOPLIGHT_YELLOW_CLASS:a}var processFieldData=function(a){var b=JSON.parse(a).data.Station.map(function(c){return{ICAO:c.station_id,name:c.site}});b.forEach(function(c){c.name=/\(/.test(c.name)&&!/\)/.test(c.name)?c.name+")":c.name;var d=document.querySelector("#"+c.ICAO);d.setAttribute("title",d.getAttribute("title").replace(/NAME:/i,"NAME:\n"+c.name))})},processMetarData=function(a){JSON.parse(a).data.METAR.filter(function(b){return new Date().valueOf()-convertTextTime(b.observation_time).valueOf()<METAR_STALE_TIME}).forEach(function(b){var c=document.getElementById(b.station_id);c.setAttribute("title",c.getAttribute("title").replace(/METAR:/i,"METAR:\n"+b.raw_text));var d=c.nextSibling;d.setAttribute("class",qcStoplight(getStoplightClassFromMetar(b,1===c.parentElement.rowIndex),d.getAttribute("class"))),d.setAttribute("title",b.raw_text)})},processTafData=function(a){JSON.parse(a).data.TAF.forEach(function(b){var c=document.querySelector("#"+b.station_id),d=c.parentElement;if(c.setAttribute("title",c.getAttribute("title").replace(/TAF:/i,"TAF:\n"+b.raw_text.replace(/(TEMPO|FM|BECMG)/gi,"\n$1"))),Array.isArray(b.forecast))b.forecast.forEach(function(f){for(var g=1;g<d.cells.length;g++)new Date(d.cells[g].getAttribute("data-starttime"))>=getLocalFromIsoZulu(f.fcst_time_from)&&new Date(d.cells[g].getAttribute("data-starttime")<getLocalFromIsoZulu(f.fcst_time_to))&&d.cells[g].setAttribute("class",qcStoplight(getStoplightClassFromTaf(f,1===d.rowIndex)))});else for(var e=1;e<d.cells.length;e++)new Date(d.cells[e].getAttribute("data-starttime"))>=getLocalFromIsoZulu(b.forecast.fcst_time_from)&&new Date(d.cells[e].getAttribute("data-starttime")<getLocalFromIsoZulu(b.forecast.fcst_time_to))&&d.cells[e].setAttribute("class",qcStoplight(getStoplightClassFromTaf(b.forecast,1===d.rowIndex)))})};function buildTable(a){var m,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:12,b=a.split(" "),c=new Date,d=+c.toString().match(/([\+-][0-9][0-9])/)[1],e=c.getHours(),f=c.getUTCHours(),g=document.createElement("table"),h=document.createElement("tr"),l=document.createElement("th");l.innerHTML="UTC Offset: "+d+"<br>UTC Day: "+c.getUTCDate(),h.appendChild(l);for(var o=0;o<n;o++)l=document.createElement("th"),l.innerHTML=(e+o)%24+"L<br>"+(f+o)%24+"Z",h.appendChild(l);return g.appendChild(h),b.forEach(function(p,q){h=document.createElement("tr"),m=document.createElement("td"),m.setAttribute("class",0===q?HOME_STATION_CLASS:ALT_CLASS),m.setAttribute("id",p),m.setAttribute("title","NAME:\nMETAR:\nTAF:"),m.innerHTML=p,h.appendChild(m);for(var r=0;r<n;r++)m=document.createElement("td"),m.setAttribute("data-ICAO",p),m.setAttribute("data-startTime",new Date(c.getFullYear(),c.getMonth(),c.getDate(),c.getHours()+r)),h.appendChild(m);g.appendChild(h)}),g.setAttribute("class","table table-sm table-bordered table-inverse"),g.setAttribute("id","wxTable"),g}Array.from||(Array.from=function(){var a=Object.prototype.toString,b=function(f){return"function"==typeof f||"[object Function]"===a.call(f)},c=function(f){var g=+f;return isNaN(g)?0:0!=g&&isFinite(g)?(0<g?1:-1)*Math.floor(Math.abs(g)):g},d=Math.pow(2,53)-1,e=function(f){var g=c(f);return Math.min(Math.max(g,0),d)};return function(g){var h=this,l=Object(g);if(null==g)throw new TypeError("Array.from requires an array-like object - not null or undefined");var n,m=1<arguments.length?arguments[1]:void 0;if("undefined"!=typeof m){if(!b(m))throw new TypeError("Array.from: when provided, the second argument must be a function");2<arguments.length&&(n=arguments[2])}for(var r,o=e(l.length),p=b(h)?Object(new h(o)):Array(o),q=0;q<o;)r=l[q],p[q]=m?"undefined"==typeof n?m(r,q):m.call(n,r,q):r,q+=1;return p.length=o,p}}());function addListeners(){var a=function(){for(var b=this.getAttribute("value"),c=document.querySelector("#tableContainer");c.firstChild;)c.removeChild(c.firstChild);c.appendChild(buildTable(b));[{name:"fields",action:processFieldData},{name:"metars",action:processMetarData},{name:"tafs",action:processTafData}].forEach(function(e){$.post("http://ec2-34-204-225-71.compute-1.amazonaws.com/proxy.php",{url:makeUrl(e.name,b)}).done(function(f){e.action(f)}).fail(function(){window.alert("fail!")})})};Array.from(document.getElementsByClassName("prebuilt")).forEach(function(b){b.addEventListener("click",a)})}addListeners();